## 310-geth-configmap.yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: ai-agent-config
  labels:
    app: ai-agent
data:
  nginx.conf: |
    server {
      listen 3000;
      server_name localhost;

      root /usr/share/nginx/html;
      index index.html;

      # Enable substitution for HTML responses
      sub_filter_types text/html;
      sub_filter_once on;

      # Cache busting for static assets
      location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
          expires 1y;
          add_header Cache-Control "public, immutable";
      }

      # Inject env.js script into index.html
      location = /index.html {
        sub_filter '</head>' '<script src="/config/env.js"></script></head>';
        sub_filter_once on;  # Ensures injection happens only once per response
        try_files $uri /index.html;
      }

      # Fallback to index.html for React routing (all other routes)
      location / {
        try_files $uri /index.html =404;
      }
    }
  env.js: |
    window.env = {
      REACT_APP_BACKEND_API: "https://dev.agenta.zeroproofai.com/chat"
    };
  NODE_ENV: development
  PORT: "3001"
